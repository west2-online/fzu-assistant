from langchain.load import dumps, loads
from langchain_core.documents import Document
import typing as t

def reciprocal_rank_fusion(results: t.List[t.List[Document]], k=60):
    fused_scores = {}
    for docs in results:
        for rank, doc in enumerate(docs):
            doc_str = dumps(doc, ensure_ascii=False)
            if doc_str not in fused_scores:
                fused_scores[doc_str] = 0
            fused_scores[doc_str] += 1 / (rank + k)

    reranked_results = [
        (loads(doc_str), score) for doc_str, score in sorted(fused_scores.items(), key=lambda x: x[1], reverse=True)
    ]
    return [x[0] for x in reranked_results[:10]]


if __name__ == "__main__":
    documents = [[Document(id='1eb50adc-9d1e-48fb-a3c2-59d1116332d1', metadata={'source': './data/notice/校务公开.json'}, page_content='日期: 2021-07-28\n标题: 关于福州大学旗山校区57间店面分别招租的公告\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1298&wbnewsid=2000\n来源: 校务公开\n'), Document(id='23770cf3-b843-418a-a46c-221e1e3059af', metadata={'source': './data/notice/校内公告.json'}, page_content='日期: 2021-07-28\n标题: 关于福州大学旗山校区57间店面分别招租的公告\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1376&wbnewsid=3447\n来源: 校内公告\n'), Document(id='2271bb84-f767-4186-b925-866f5c088af2', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2023-07-18\n标题: 关于福州大学旗山校区校友入校相关事项的通知\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1334&wbnewsid=34329\n来源: 通知文件\n'), Document(id='46469689-42f5-47bf-912c-fbf6940b6448', metadata={'source': './data/notice/校务公开.json'}, page_content='日期: 2021-08-19\n标题: 关于福州大学旗山校区57间店面分别招租的成交结果公示\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1298&wbnewsid=2017\n来源: 校务公开\n'), Document(id='6b525aa6-81df-47b8-aa11-bebcd9a76608', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2018-08-09\n标题: 关于福州大学旗山校区教学区主要道路命名的公示\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1302&wbnewsid=29371\n来源: 通知文件\n'), Document(id='a4ba2488-1b6b-4d2f-93e1-f54a5b4c2249', metadata={'source': './data/notice/校内公告.json'}, page_content='日期: 2021-08-19\n标题: 关于福州大学旗山校区57间店面分别招租的成交结果公示\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1376&wbnewsid=3408\n来源: 校内公告\n'), Document(id='49216ff7-c607-4023-842e-85deb9a728c6', metadata={'source': './data/notice/教学文件.json'}, page_content='日期: 2021-11-09\n标题: 福州大学本科教学规范\n链接: https://jwch.fzu.edu.cn/info/1094/11949.htm\n来源: 教学文件\n'), Document(id='048401a3-c9ee-4154-be0a-bb9006da659a', metadata={'source': './data/notice/校务公开.json'}, page_content='日期: 2021-12-14\n标题: 关于福州大学旗山校区5间店面的招租公告\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1298&wbnewsid=1753\n来源: 校务公开\n'), Document(id='0f48f90a-578b-4373-a8d5-33f7af078289', metadata={'source': './data/notice/教学通知.json'}, page_content='日期: 2020-02-03\n标题: 福州大学关于做好2019-2020学年第二学期延期开学本科教学工作安排的通知\n链接: https://jwch.fzu.edu.cn/../info/1012/11355.htm\n来源: 教学通知\n'), Document(id='cdd61540-d741-4db0-a33b-27e4aa25d585', metadata={'source': './data/notice/校务公开.json'}, page_content='日期: 2021-07-30\n标题: 关于福州大学旗山校区3间店面分别招租的公告\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1298&wbnewsid=2003\n来源: 校务公开\n')], [Document(id='2271bb84-f767-4186-b925-866f5c088af2', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2023-07-18\n标题: 关于福州大学旗山校区校友入校相关事项的通知\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1334&wbnewsid=34329\n来源: 通知文件\n'), Document(id='6b525aa6-81df-47b8-aa11-bebcd9a76608', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2018-08-09\n标题: 关于福州大学旗山校区教学区主要道路命名的公示\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1302&wbnewsid=29371\n来源: 通知文件\n'), Document(id='be1468de-cab3-4e20-b2a3-45e4c899b4a5', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2023-10-26\n标题: 关于公布福州大学旗山校区主要湖面命名的通知\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1322&wbnewsid=34955\n来源: 通知文件\n'), Document(id='6bd1a5e9-e48a-42b5-946c-47cba22d8271', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2013-01-18\n标题: 福州大学旗山校区餐厅招商\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1329&wbnewsid=18484\n来源: 通知文件\n'), Document(id='92bf39ed-863b-4f70-a5cf-ab8a55cd0cbc', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2012-01-06\n标题: 福州大学旗山校区餐厅招商\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1329&wbnewsid=18471\n来源: 通知文件\n'), Document(id='1eb50adc-9d1e-48fb-a3c2-59d1116332d1', metadata={'source': './data/notice/校务公开.json'}, page_content='日期: 2021-07-28\n标题: 关于福州大学旗山校区57间店面分别招租的公告\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1298&wbnewsid=2000\n来源: 校务公开\n'), Document(id='0a4f6a0c-3ff0-48bc-a325-4175d646ab20', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2023-08-31\n标题: 关于开通福州大学往返铜盘校区与旗山校区213路公交快线的友情提示     \n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1419&wbnewsid=34595\n来源: 通知文件\n'), Document(id='49216ff7-c607-4023-842e-85deb9a728c6', metadata={'source': './data/notice/教学文件.json'}, page_content='日期: 2021-11-09\n标题: 福州大学本科教学规范\n链接: https://jwch.fzu.edu.cn/info/1094/11949.htm\n来源: 教学文件\n'), Document(id='d89d5989-fb4a-4f1f-b032-d71943106bfa', metadata={'source': './data/notice/教学通知.json'}, page_content='日期: 2021-06-29\n标题: 关于召开福州大学2020-2021学年春季学期期末教学工作会议的通知\n链接: https://jwch.fzu.edu.cn/../info/1012/11053.htm\n来源: 教学通知\n'), Document(id='46469689-42f5-47bf-912c-fbf6940b6448', metadata={'source': './data/notice/校务公开.json'}, page_content='日期: 2021-08-19\n标题: 关于福州大学旗山校区57间店面分别招租的成交结果公示\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1298&wbnewsid=2017\n来源: 校务公开\n')], [Document(id='86cd5a2f-82ce-4d2a-93f5-d1587fd4d651', metadata={'source': './data/notice/下载专区.json'}, page_content='日期: 2015-03-19\n标题: 附件19：福州大学本科生毕业设计（论文）情况汇总表\n链接: https://jwch.fzu.edu.cn/../info/1069/4285.htm\n来源: 下载专区\n'), Document(id='b48dd401-6da8-4b74-9b70-a2105396fd3b', metadata={'source': './data/notice/下载专区.json'}, page_content='日期: 2013-04-03\n标题: 2013年福州大学各学院接收转专业学生计划表\n链接: https://jwch.fzu.edu.cn/../info/1066/4226.htm\n来源: 下载专区\n'), Document(id='65a39fe0-7373-44ad-9395-0e74d0dcf9ec', metadata={'source': './data/notice/下载专区.json'}, page_content='日期: 2015-03-19\n标题: 附件18：福州大学本科生毕业设计（论文）情况登记表\n链接: https://jwch.fzu.edu.cn/../info/1069/4287.htm\n来源: 下载专区\n'), Document(id='a4b31a5e-fdd8-4ed4-a897-7472ef0fec93', metadata={'source': './data/notice/教学通知.json'}, page_content='日期: 2021-09-26\n标题: 福州大学关于公布2021级“数理综合班”学生名单的通知\n链接: https://jwch.fzu.edu.cn/../info/1037/10821.htm\n来源: 教学通知\n'), Document(id='6c9dfbca-a7c9-4828-a75b-a556bf6a709d', metadata={'source': './data/notice/教学通知.json'}, page_content='日期: 2020-08-24\n标题: 福州大学关于公布2018级数理综合班专业分流学生名单及学科导师名单的通知\n链接: https://jwch.fzu.edu.cn/../info/1037/8160.htm\n来源: 教学通知\n'), Document(id='b4e478b8-8ba1-4ef0-acae-aa4e0c32d23f', metadata={'source': './data/notice/教学文件.json'}, page_content='日期: 2022-07-10\n标题: 福州大学本科专业设置管理办法（试行）\n链接: https://jwch.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1091&wbnewsid=9588\n来源: 教学文件\n'), Document(id='6e05ccb0-74c5-4cf5-bb9b-6aa531d6fdcc', metadata={'source': './data/notice/教学通知.json'}, page_content='日期: 2023-05-17\n标题: 福州大学关于公布2021级数理综合班专业分流学生名单及学科导师名单的通知\n链接: https://jwch.fzu.edu.cn/../info/1037/12770.htm\n来源: 教学通知\n'), Document(id='04115db1-4de6-4bfb-82d9-a065ac32851a', metadata={'source': './data/notice/讲座报告.json'}, page_content='标题: 福州大学嘉锡讲坛第604期讲座：《福建传统福文化》\n链接: https://www-443.webvpn.fzu.edu.cn//info/1061/8458.htm\n日期: 2023-02-27\n来源: 讲座报告\n'), Document(id='c8245549-f90b-4d39-82e5-dac84cb8f3a5', metadata={'source': './data/notice/教学文件.json'}, page_content='日期: 2018-09-01\n标题: 福州大学授予学士学位工作细则(暂行）\n链接: https://jwch.fzu.edu.cn/../info/1056/4050.htm\n来源: 教学文件\n'), Document(id='eaf34601-1f32-4f14-8f51-885607bc6ffd', metadata={'source': './data/notice/教学文件.json'}, page_content='日期: 2018-09-01\n标题: 福州大学本科生转专业管理实施办法（暂行）\n链接: https://jwch.fzu.edu.cn/../info/1056/4052.htm\n来源: 教学文件\n')], [Document(id='2d5c903e-56ac-4fab-bcf8-987fa4fdf35d', metadata={'source': './data/notice/校务公开.json'}, page_content='日期: 2019-06-03\n标题: 关于福州大学旗山校区消防系统维保服务项目的结果公告\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1298&wbnewsid=5289\n来源: 校务公开\n'), Document(id='32679c35-c32e-4a6c-8823-b054fe6de692', metadata={'source': './data/notice/校内公告.json'}, page_content='日期: 2019-06-03\n标题: 关于福州大学旗山校区消防系统维保服务项目的结果公告\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1376&wbnewsid=3871\n来源: 校内公告\n'), Document(id='2271bb84-f767-4186-b925-866f5c088af2', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2023-07-18\n标题: 关于福州大学旗山校区校友入校相关事项的通知\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1334&wbnewsid=34329\n来源: 通知文件\n'), Document(id='34d47361-8d5a-436c-9582-1304e9f7a323', metadata={'source': './data/notice/校务公开.json'}, page_content='日期: 2019-05-08\n标题: 福州大学旗山校区消防系统维保服务项目招标公告\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1298&wbnewsid=5344\n来源: 校务公开\n'), Document(id='6bd1a5e9-e48a-42b5-946c-47cba22d8271', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2013-01-18\n标题: 福州大学旗山校区餐厅招商\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1329&wbnewsid=18484\n来源: 通知文件\n'), Document(id='a56234ea-351a-4458-baa6-6a58ef0e7ee0', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2023-12-27\n标题: 关于福州大学旗山校区离退休人员入校相关事项的通知\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1313&wbnewsid=35578\n来源: 通知文件\n'), Document(id='92bf39ed-863b-4f70-a5cf-ab8a55cd0cbc', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2012-01-06\n标题: 福州大学旗山校区餐厅招商\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1329&wbnewsid=18471\n来源: 通知文件\n'), Document(id='7de740d4-8c63-4e35-b13c-e0b8f16fe023', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2024-08-28\n标题: 关于新学期福州大学往返铜盘校区与旗山校区定制公交运行的友情提示\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1419&wbnewsid=37012\n来源: 通知文件\n'), Document(id='3eecce44-6b9b-47d7-9f72-d26cabb24dfe', metadata={'source': './data/notice/校内公告.json'}, page_content='日期: 2019-05-08\n标题: 福州大学旗山校区消防系统维保服务项目招标公告\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1376&wbnewsid=3913\n来源: 校内公告\n'), Document(id='24b5faea-1c11-4e93-af65-23f1be56133e', metadata={'source': './data/notice/通知文件.json'}, page_content='日期: 2023-08-24\n标题: 关于新学期福州大学往返铜盘校区与旗山校区定制公交运行的友情提示\n链接: https://info22-443.webvpn.fzu.edu.cn/content.jsp?urltype=news.NewsContentUrl&wbtreeid=1419&wbnewsid=34544\n来源: 通知文件\n')]]

    reciprocal_rank_fusion(documents)
